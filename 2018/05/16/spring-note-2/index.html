<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java Web,Spring," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="本文介绍一个由 Spring 框架构建的登录模块入门例子的具体步骤。例子的完整代码已托管到 gayhub 上，地址https://github.com/linj2n/spring-demos">
<meta name="keywords" content="Java Web,Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring学习总结（2）Spring + Spring MVC 入门实例">
<meta property="og:url" content="http://linj2n.cn/2018/05/16/spring-note-2/index.html">
<meta property="og:site_name" content="1 &#x2F; 0 == ∞">
<meta property="og:description" content="本文介绍一个由 Spring 框架构建的登录模块入门例子的具体步骤。例子的完整代码已托管到 gayhub 上，地址https://github.com/linj2n/spring-demos">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-1.jpg">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-2.png">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-3.jpg">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-4.png">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-5.png">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-6.png">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-7.png">
<meta property="og:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-8.png">
<meta property="og:updated_time" content="2018-05-22T07:56:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring学习总结（2）Spring + Spring MVC 入门实例">
<meta name="twitter:description" content="本文介绍一个由 Spring 框架构建的登录模块入门例子的具体步骤。例子的完整代码已托管到 gayhub 上，地址https://github.com/linj2n/spring-demos">
<meta name="twitter:image" content="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: 'K1Q1DQ07MZ',
      apiKey: '',
      indexName: 'linj2nBlog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://linj2n.cn/2018/05/16/spring-note-2/"/>





  <title>Spring学习总结（2）Spring + Spring MVC 入门实例 | 1 / 0 == ∞</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">1 / 0 == ∞</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Done is better than perfect.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linj2n.cn/2018/05/16/spring-note-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linj2n">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="1 / 0 == ∞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring学习总结（2）Spring + Spring MVC 入门实例</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-16T13:42:54+08:00">
                2018/05/16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote><p>本文介绍一个由 Spring 框架构建的<strong>登录模块</strong>入门例子的具体步骤。例子的完整代码已托管到 gayhub 上，地址<a href="https://github.com/linj2n/spring-demos" target="_blank" rel="noopener">https://github.com/linj2n/spring-demos</a></p>
</blockquote>
<a id="more"></a>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><ul>
<li>mysql</li>
<li>MySQLWorkbench</li>
<li>IDEA</li>
</ul>
<h2 id="创建库表"><a href="#创建库表" class="headerlink" title="创建库表"></a>创建库表</h2><p><strong><code>db.sql</code>文件</strong>，存放在<code>schema</code>文件夹中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> helloworlddb;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> helloworlddb <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="keyword">USE</span> sampledb;</span><br><span class="line"></span><br><span class="line">## 创建用户表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">    user_id   <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    user_name <span class="built_in">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    <span class="keyword">password</span>  <span class="built_in">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    last_visit datetime,</span><br><span class="line">    last_ip  <span class="built_in">VARCHAR</span>(<span class="number">23</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br><span class="line"></span><br><span class="line">##创建用户登录日志表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_login_log (</span><br><span class="line">   login_log_id  <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">   user_id   <span class="built_in">INT</span>,</span><br><span class="line">   ip  <span class="built_in">VARCHAR</span>(<span class="number">23</span>),</span><br><span class="line">   login_datetime datetime</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br><span class="line"></span><br><span class="line">##插入初始化数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user (user_name,<span class="keyword">password</span>) </span><br><span class="line">             <span class="keyword">VALUES</span>(<span class="string">'admin'</span>,<span class="string">'123456'</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>与在<code>bash</code>窗口运行语句不同，这里选择MySQLWorkbench 数据库建模工具建立<code>Helloworld</code>项目所需的数据库。前往<code>mysqlWorkbench</code>官网下载安装。<a href="https://www.mysql.com/products/workbench/" target="_blank" rel="noopener">MySQLworkbench官网</a></p>
<p>打开 <code>mysqlWorkbench</code>，新建一个 sql 语句窗口复制 db.sql 文件中的内容至执行窗口中，点击执行，运行我们提前写好的 sql 语句，刷新后即可看到我们建好的库了。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-1.jpg" alt="spring-hw-pic-1"></p>
<h1 id="建立Maven项目"><a href="#建立Maven项目" class="headerlink" title="建立Maven项目"></a>建立Maven项目</h1><p>IDEA 如何创建一个 Maven 项目，见前面博文<a href="http://linj2n.cn/2018/05/08/spring-note-1/">Spring学习总结（1） Spring 概述与入门配置</a></p>
<h2 id="配置-pom-xml-文件依赖"><a href="#配置-pom-xml-文件依赖" class="headerlink" title="配置 pom.xml 文件依赖"></a>配置 pom.xml 文件依赖</h2><p><strong><code>pom.xml</code>文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.linj2n.spring-helloworld<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-helloworld<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring 依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbcp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aspectj.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.testng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>testng<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;testng.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- jetty插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mortbay.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jetty-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">connectors</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">connector</span> <span class="attr">implementation</span>=<span class="string">"org.mortbay.jetty.nio.SelectChannelConnector"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">port</span>&gt;</span>8000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">maxIdleTime</span>&gt;</span>60000<span class="tag">&lt;/<span class="name">maxIdleTime</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">connector</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">connectors</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">contextPath</span>&gt;</span>/bbs<span class="tag">&lt;/<span class="name">contextPath</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">scanIntervalSeconds</span>&gt;</span>0<span class="tag">&lt;/<span class="name">scanIntervalSeconds</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">parallel</span>&gt;</span>methods<span class="tag">&lt;/<span class="name">parallel</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">threadCount</span>&gt;</span>10<span class="tag">&lt;/<span class="name">threadCount</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file.encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">file.encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.29<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet.version</span>&gt;</span>3.0-alpha-1<span class="tag">&lt;/<span class="name">servlet.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aspectj.version</span>&gt;</span>1.8.1<span class="tag">&lt;/<span class="name">aspectj.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-codec.version</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">commons-codec.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-dbcp.version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">commons-dbcp.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hibernate.validator.version</span>&gt;</span>5.0.2.Final<span class="tag">&lt;/<span class="name">hibernate.validator.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jetty.version</span>&gt;</span>8.1.8.v20121106<span class="tag">&lt;/<span class="name">jetty.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.5<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testng.version</span>&gt;</span>6.8.7<span class="tag">&lt;/<span class="name">testng.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure> </p>
<h2 id="类包规划"><a href="#类包规划" class="headerlink" title="类包规划"></a>类包规划</h2><p>类包以分层的方式进行组织，供划分为4个包，分别是dao、domain、service和web。严格来说，领域对象(实体类)属于业务层，但是由于领域对象可能同时被持久层和展示层共享，因此一般将其划分到一个包中。</p>
<p>单元测试的类包与程序的类包对应，但放置到不同的文件夹下。整个项目的文件结构见下图<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-2.png" alt="spring-hw-pic-2"></p>
<h2 id="Spring配置文件"><a href="#Spring配置文件" class="headerlink" title="Spring配置文件"></a>Spring配置文件</h2><p>Spring 可以将所有的配置信息同一到一个文件中，也可以放置到多个文件中，对于简单的应用，由于配置信息少，仅用一个配置文件就足以应付了。因此我们直接采用一个配置文件 spring-context.xml 即可。</p>
<h1 id="持久层"><a href="#持久层" class="headerlink" title="持久层"></a>持久层</h1><blockquote><p>持久层负责数据的访问和操作，DAO 类被上层的业务层调用，Spring 本身支持多种流行的 ORM 框架，这里将使用 Spring JDBC 作为持久层的实现技术。</p>
<p>领域对象（Domain Object）也被称为实体类，代表着<strong>业务的状态</strong>，贯穿展示层、业务层和持久层，最终被持久化到数据库中。领域对象使数据库操作以面向对象的方式进行，为程序的扩展带来更大的灵活性。</p>
<p>领域对象不一定等同于数据库表，不过对于一些简单的应用，领域对象往往拥有对应的数据库表。</p>
</blockquote>
<p><strong>注1：领域模型中的实体类分类：</strong></p>
<ul>
<li>PO 持久化对象，表示持久层的哦数据结构，如数据库表，<strong>持久层</strong></li>
<li>DO 业务实体对象，属于<strong>服务层</strong></li>
<li>DTO 数据传输对象，属于<strong>服务层</strong></li>
<li>VO 视图对象，属于<strong>展示层</strong></li>
</ul>
<p><strong>注2：</strong>对于简单模块来说，有时 PO、DO和 VO没有区别，直接复用 PO 即可。</p>
<h2 id="domain-包"><a href="#domain-包" class="headerlink" title="domain 包"></a>domain 包</h2><p>登录实例的领域对象（实体类）存放在domain包中，包括两个领域对象：<code>User</code>和<code>LoginLog</code>，分别代表用户信息和日志信息。也对应着<code>t_user</code>和<code>t_login_log</code>数据表。</p>
<h3 id="用户领域对象"><a href="#用户领域对象" class="headerlink" title="用户领域对象"></a>用户领域对象</h3><p><strong><code>User.java</code>文件</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String lastIp;</span><br><span class="line">    <span class="keyword">private</span> Date lastVisit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter、setter方法，省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="登录日志领域对象"><a href="#登录日志领域对象" class="headerlink" title="登录日志领域对象"></a>登录日志领域对象</h3><p><strong><code>LoginLog.java</code>文件</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginLog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loginLogId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">    <span class="keyword">private</span> Date loginDate;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// getter、setter方法，省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="dao-包"><a href="#dao-包" class="headerlink" title="dao 包"></a>dao 包</h2><h3 id="UserDao"><a href="#UserDao" class="headerlink" title="UserDao"></a>UserDao</h3><p>上一篇博文提到面向接口编程配合 Spring 能够在一定程度上使解耦，有利于程序的扩展与维护。因此我们也采用面向接口的方式设计持久层。首先来看 <code>UserDao</code>接口类。</p>
<p><code>UserDaoApi</code>接口包括三个方法：</p>
<ul>
<li><p><code>getMatchCount()</code>: 根据用户名和密码获取匹配的用户数，<code>1</code>表示用户名、密码正确，<code>0</code>表示用户名、密码错误。</p>
</li>
<li><p><code>findUserByUserName()</code>: 根据用户名获取 User 对象</p>
</li>
<li><p><code>updateLoginInfo()</code>: 用户登录后，更新用户的最后登录 IP 及最后登录时间</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.dao;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDaoApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMatchCount</span><span class="params">(String userName, String password)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span> <span class="params">(<span class="keyword">final</span> String userName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLoginInfo</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UserDaoImpl</code>实现了<code>UserDaoApi</code>接口，使用了 Spring JDBC ，维护一个私有<code>JdbcTemplate</code>对象实例，所有的与数据库打交道的操作都是通过这个<code>JdbcTemplate</code>实例，简单介绍一下 Spring JDBC，它只是对 JDBC API 进行薄层的封装，将样板式的代码和那些必不可少的代码进行了分离，减轻使用者的负担。</p>
<p>下面对代码其中最复杂的函数做介绍：</p>
<p><strong><code>JdbcTemplate.query(String sql，Object[] args，RowCallbackHandler rsh)</code></strong>接受三个参数：</p>
<ul>
<li><code>String sql</code> : 查询的 SQL 语句，允许使用带“？”的参数占位符</li>
<li><code>Object[] args</code> :SQL 语句中占位符对应的参数数组</li>
<li><code>RowCallbackHandler</code>: 查询结果的处理回调接口，该回调接口有一个 <code>procesRow(ResultSet rs)</code>负责将查询的结果从 <code>ResultSet</code>装载到类似于领域对象的对象实例中</li>
</ul>
<p>在<code>findUserByUserName()</code>方法中，通过匿名内部类的方式定义一个 RowCallbackHandler回调接口实例，将 ResultSet 转换为 User 对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jdbcTemplate.query(MACTCH_COUNT_SQL, <span class="keyword">new</span> Object[]&#123;userName&#125;,</span><br><span class="line">        <span class="comment">// 匿名方式实现的回调函数</span></span><br><span class="line">        <span class="keyword">new</span> RowCallbackHandler() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span><span class="params">(ResultSet resultSet)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                user.setUserId(resultSet.getInt(<span class="string">"user_id"</span>));</span><br><span class="line">                user.setUserName(resultSet.getString(userName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p><strong><code>UserDaoImpl.java</code>文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.linj2n.dao.UserDaoApi;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowCallbackHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// 1. 通过 Spring 注解定义一个 DAO</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDaoApi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span>  <span class="keyword">static</span> String MACTCH_COUNT_SQL = <span class="string">" SELECT count(*) FROM t_user  "</span> +</span><br><span class="line">            <span class="string">" WHERE user_name =? and password=? "</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String UPDATE_LOGIN_INFO_SQL = <span class="string">" UPDATE t_user SET "</span> +</span><br><span class="line">            <span class="string">" last_visit=?,last_ip=? WHERE user_id=? "</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMatchCount</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(MACTCH_COUNT_SQL,<span class="keyword">new</span> Object[]&#123;userName,password&#125;,Integer.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span> <span class="params">(<span class="keyword">final</span> String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> User user = <span class="keyword">new</span> User();</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.query(MACTCH_COUNT_SQL, <span class="keyword">new</span> Object[]&#123;userName&#125;,</span><br><span class="line">                <span class="comment">// 匿名方式实现的回调函数</span></span><br><span class="line">                <span class="keyword">new</span> RowCallbackHandler() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span><span class="params">(ResultSet resultSet)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                        user.setUserId(resultSet.getInt(<span class="string">"user_id"</span>));</span><br><span class="line">                        user.setUserName(resultSet.getString(userName));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLoginInfo</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(UPDATE_LOGIN_INFO_SQL, <span class="keyword">new</span> Object[] &#123;user.getLastVisit(),</span><br><span class="line">                user.getLastIp(),user.getUserId()&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">// 2. 自动注入 JdbcTemplate Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们使用 <code>@Repository</code>定义了一个DAO Bean、使用<code>@Autowired</code>将 Spring 容器中的 Bean 注入进来，关于 Spring 的注解配置，以后会进行详细的介绍。</p>
<h3 id="LoginLogDao"><a href="#LoginLogDao" class="headerlink" title="LoginLogDao"></a>LoginLogDao</h3><p><code>LoginLogDao</code>负责记录用户的登录日志，只有一个<code>insertLoginLog</code>接口方法，与<code>UserDao</code>相似，其实现类也同过 <code>JdbcTemplate.update(String sql, Object[] args)</code>方法完成登录日志插入的操作。</p>
<p><strong><code>LoginLogDao.java</code>文件</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.linj2n.dao.LoginInfoDaoApi;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.LoginLog;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInfoDaoImpl</span> <span class="keyword">implements</span> <span class="title">LoginInfoDaoApi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String INSERT_LOGIN_INFO_SQL = <span class="string">" INSERT INTO t_login_log(user_id,ip,login_datetime) VALUES(?,?,?)"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>`</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertLoginInfo</span><span class="params">(LoginLog loginLog)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(INSERT_LOGIN_INFO_SQL,<span class="keyword">new</span> Object[]&#123;</span><br><span class="line">                loginLog.getUserId(),</span><br><span class="line">                loginLog.getIp(),</span><br><span class="line">                loginLog.getLoginDate()&#125;</span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="在xml文件中配置Bean类"><a href="#在xml文件中配置Bean类" class="headerlink" title="在xml文件中配置Bean类"></a>在xml文件中配置Bean类</h2><p>在编写DAO接口的实现类时，我们使用了<code>JdbcTemplate</code>，因此在<code>src\resources</code>的配置文件中增加支持<code>JdbcTemplate</code>的<code>bean</code>类。</p>
<p>在IDEA左侧的项目目录树，选中<code>src\resources</code>文件夹，点击右键新建一个<code>context.xml</code>配置文件如下图。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-3.jpg" alt="spring-hw-pic-3"></p>
<p><strong>DAO的配置</strong></p>
<p>在context.xml中添加如下配置信息。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 扫描类包，将标注Spring注解的类自动转化Bean，同时完成Bean的注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.linj2n.dao"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">destroy-method</span>=<span class="string">"close"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:driverClassName</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:url</span>=<span class="string">"jdbc:mysql://localhost:3306/helloworlddb"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:username</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:password</span>=<span class="string">"your-password"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Jdbc模板  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:dataSource-ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong></p>
<ul>
<li>使用<code>&lt;context:component-scan&gt;</code>扫描指定类包下所有的类，这样在类中定义的Spring注解（如<code>@Repository、@Autowired</code>等）才能产生作用。</li>
</ul>
<h1 id="业务层"><a href="#业务层" class="headerlink" title="业务层"></a>业务层</h1><p>在登录实例中，业务层仅有一个业务接口，即 UserServiceApi。UserServiceApi 负责将持久层的 UserDao 和LoginLoginDao 组织起来，完成<strong>用户账户</strong>和<strong>密码认证</strong>、<strong>登录日志记录</strong>等操作。</p>
<h2 id="UserServiceApi"><a href="#UserServiceApi" class="headerlink" title="UserServiceApi"></a><code>UserServiceApi</code></h2><p><code>userServiceApi</code> 业务接口拥有三个方法，其中，<code>hasMatchUser()</code>方法用于检查用户名与密码的正确性；<code>findUserByUserName()</code>方法以用户名为条件加载<code>User</code>对象；<code>loginSuccess()</code>在用户登录后成功后调用，更新用户最后的登录时间和IP信息，同时记录用户登录日志。</p>
<p><strong><code>UserServiceApi.java</code></strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.service;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserServiceApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasMatchUser</span><span class="params">(String userName,String password)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span><span class="params">(String userName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginSuccess</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="UserServiceImpl"><a href="#UserServiceImpl" class="headerlink" title="UserServiceImpl"></a><code>UserServiceImpl</code></h2><p><code>UserServiceImpl</code>实现了<code>UserServiceApi</code>接口，需要调用DAO层的<code>UserDaoApi</code>与<code>LoginInfoApi</code>完成业务逻辑操作。<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.linj2n.dao.LoginInfoDaoApi;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.dao.UserDaoApi;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.LoginLog;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.service.UserServiceApi;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserServiceApi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDaoApi userDao;</span><br><span class="line">    <span class="keyword">private</span> LoginInfoDaoApi loginInfoDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDaoApi userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoginInfoDaoApi</span><span class="params">(LoginInfoDaoApi loginInfoDaoApi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loginInfoDao = loginInfoDaoApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasMatchUser</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> matchCount = userDao.getMatchCount(userName,password);</span><br><span class="line">        <span class="keyword">return</span> matchCount &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserByUserName(userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginSuccess</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        LoginLog loginLog = <span class="keyword">new</span> LoginLog();</span><br><span class="line">        loginLog.setUserId(user.getUserId());</span><br><span class="line">        loginLog.setIp(user.getLastIp());</span><br><span class="line">        loginLog.setLoginDate(user.getLastVisit());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 持久化登录信息至数据库</span></span><br><span class="line">        userDao.updateLoginInfo(user);</span><br><span class="line">        loginInfoDao.insertLoginInfo(loginLog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong></p>
<ul>
<li><code>UserServiceImpl</code>使用的注解有三个，第一个注解<code>@Service</code>将<code>UserServiceImpl</code>标注为一个服务层的Bean。第二个注解<code>@Autowired</code>负责将<code>userDao</code>与<code>loginLogDao</code>这两个DAO层的Bean注入。最后一个注解<code>@Transaction</code>为事务注解，让<code>loginSuccess()</code>方法运行在事务环境中，共同完成一个事务性的数据操作。</li>
</ul>
<h2 id="在xml中配置Bean类"><a href="#在xml中配置Bean类" class="headerlink" title="在xml中配置Bean类"></a>在xml中配置Bean类</h2><p>在完成<code>UserServiceImpl</code>类的编写，我们要在<code>context.xml</code>文件中编写对应注解<code>Bean</code>类，在<code>context.xml</code>中添加如下配置信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.linj2n.service"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:dataSource-ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP配置提供事务增强，让service包下所有Bean的所有方法拥有事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"serviceMethod"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">expression</span>=<span class="string">"(execution(* com.smart.service..*(..))) and (@annotation(org.springframework.transaction.annotation.Transactional))"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">pointcut-ref</span>=<span class="string">"serviceMethod"</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure>
<p><strong>注：</strong></p>
<ul>
<li>在<beans>声明出添加 aop 和 tm 命名空间的 Schema 定义文件的说明。</beans></li>
<li>使用<code>&lt;contex:commponent-scan&gt;</code>标签使得<code>service</code>包中类的注解生效.</li>
<li>配置事务管理器需要引用一个<code>dataSource Bean</code>。</li>
<li>使用<code>aop</code>、<code>tx</code>标签，以AOP的方式为<code>cn.linj2n.service</code>包下所有标注<code>@Transaction</code>注解的方法都添加了事务增强。</li>
</ul>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p><strong><code>UserServiceImplTest.java</code></strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.testng.AbstractTransactionalTestNGSpringContextTests;</span><br><span class="line"><span class="keyword">import</span> org.testng.annotations.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.testng.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath*:/context.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImplTest</span> <span class="keyword">extends</span> <span class="title">AbstractTransactionalTestNGSpringContextTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span>	<span class="comment">// 注入Spring容器中的Bean</span></span><br><span class="line">    <span class="keyword">private</span> UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 标注测试方法</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHasMatchUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b1 = userService.hasMatchUser(<span class="string">"admin"</span>, <span class="string">"123456"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> b2 = userService.hasMatchUser(<span class="string">"admin"</span>, <span class="string">"1111"</span>);</span><br><span class="line">        assertTrue(b1);</span><br><span class="line">        assertTrue(!b2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserByUserName</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        User user = userService.findUserByUserName(<span class="string">"admin"</span>);</span><br><span class="line">        assertEquals(user.getUserName(),<span class="string">"admin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddLoginLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userService.findUserByUserName(<span class="string">"admin"</span>);</span><br><span class="line">        user.setUserId(<span class="number">1</span>);</span><br><span class="line">        user.setUserName(<span class="string">"admin"</span>);</span><br><span class="line">        user.setLastIp(<span class="string">"192.168.12.7"</span>);</span><br><span class="line">        user.setLastVisit(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="展示层"><a href="#展示层" class="headerlink" title="展示层"></a>展示层</h1><p>展示层使用 Spring MVC 框架，涉及View层的文件及在工程目录下的位置如下。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-4.png" alt="spring-hw-pic-4"></p>
<h2 id="配置Spring-MVC-框架"><a href="#配置Spring-MVC-框架" class="headerlink" title="配置Spring MVC 框架"></a>配置Spring MVC 框架</h2><p>首先对<code>web.xml</code>文件进行配置，目的是让Web容器启动时能够自动启动Spring容器，<code>web.xml</code>位于<code>src/main/webapp/WEB-INF/</code>目录下。</p>
<p><strong><code>web.xml</code>文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">"2.5"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--从类路径下加载Spring配置文件，classpath关键字特指类路径下加载--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--负责启动Spring容器的监听器，它将引用上面的上下文菜蔬获得Spring配置文件的地址--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">			org.springframework.web.context.ContextLoaderListener</span><br><span class="line">		<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Spring MVC 的主控Servlet --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>linj2n<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">			org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">		<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>3<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--Spring MVC 处理的URL--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>linj2n<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong></p>
<ul>
<li>web 容器上下文参数<code>&lt;context-param&gt;</code>指定 Spring 配置文件的地址，多个配置文件逗号或分号隔开。</li>
<li><code>&lt;listener&gt;</code>引用<code>&lt;context-param&gt;</code>中<code>Spring</code>所提供的<code>ContextLoaderListener</code>的Web容器监听器，该监听器会在 Web 容器启动时自动运行，更具<code>contextConfigLocation</code>Web容器参数获取 Spring 配置文件，并启动 Spring 容器。</li>
<li><code>&lt;servlet-mapping&gt;</code>让所有以<code>.html</code>为后缀的 URL 都能被<code>linj2n-servlet</code>截获，进而转由<code>Spring MVC</code>框架进行处理。</li>
</ul>
<h2 id="处理登录请求"><a href="#处理登录请求" class="headerlink" title="处理登录请求"></a>处理登录请求</h2><h3 id="1-编写LoginController控制器类"><a href="#1-编写LoginController控制器类" class="headerlink" title="1.编写LoginController控制器类"></a>1.编写<code>LoginController</code>控制器类</h3><p><strong><code>LoginController.java</code>文件</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.linj2n.domain.User;</span><br><span class="line"><span class="keyword">import</span> cn.linj2n.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标注成为一个Spring MVC 的Controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 负责处理/index.html的请求</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/index.html"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">loginPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 负责处理/loginCheck.html的请求</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/loginCheck.html"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">loginCheck</span><span class="params">(HttpServletRequest request,LoginCommand loginCommand)</span></span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> isValidUser =  userService.hasMatchUser(loginCommand.getUserName(),</span><br><span class="line">					                    loginCommand.getPassword());</span><br><span class="line">		<span class="keyword">if</span> (!isValidUser) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"login"</span>, <span class="string">"error"</span>, <span class="string">"用户名或密码错误。"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			User user = userService.findUserByUserName(loginCommand</span><br><span class="line">					.getUserName());</span><br><span class="line">			user.setLastIp(request.getLocalAddr());</span><br><span class="line">			user.setLastVisit(<span class="keyword">new</span> Date());</span><br><span class="line">			userService.loginSuccess(user);</span><br><span class="line">			request.getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"main"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserServiceImpl userService)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userService = userService;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong></p>
<ul>
<li>一个控制器可以拥有多个处理映射不同 HTTP 请求路径的方法，通过<code>@RequestMapping</code>指定方法如何映射请求路径。</li>
<li>请求参数会更具参数名称的默认约定，自动绑定到相应方法的入参中，<code>loginCheck(HttpServletRequest request,LoginCommand loginCommad)</code>方法中，请求参数会根据名称匹配绑定到<code>loginCommand</code>的入参中。</li>
<li><code>ModelAndView</code>对象既包括视图信息，又包括视图渲染所需要的模型数据信息，这里的用户仅需要一张视图即可。</li>
<li>请求相应方法可以返回一个<code>ModelAndView</code>或<code>String</code>，Spring MVC 会进行解析然后转型目标响应页面。</li>
<li><code>ModelAndView(&quot;login&quot;,&quot;error&quot;,&quot;用户名或密码错误。&quot;)</code>，第一个参数代表视图的逻辑名，第二和第三个参数分别代表<strong>数据模型名称和数据模型对象</strong>，数据模型对象将以数据模型名称为参数名放置到<code>request</code>的属性中。</li>
</ul>
<p><strong><code>LoginCommand.java</code>文件</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.linj2n.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginCommand</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong></p>
<ul>
<li><code>LoginCommand</code>对象是一个<code>POJO</code>，即<strong>没有继承特定的父类或实现特定的接口。</strong>包括用户、密码两个属性。</li>
</ul>
<h3 id="2-Spring-MVC-配置文件"><a href="#2-Spring-MVC-配置文件" class="headerlink" title="2.Spring MVC 配置文件"></a>2.Spring MVC 配置文件</h3><p>编写好的<code>LoginCommand</code>后，需要配置<code>Spring MVC</code>。用到一个<code>servlet.xml</code>，命名规则为<code>xxx-servlet.xml</code>。在<code>src/main/webapp/WEB-INF/</code>目录下创建名称为<code>linj2n-servlet.xml</code>的文件，这个 Spring MVC 配置文件主要完成两件事。</p>
<ul>
<li>扫描web包，应用Spring的注解</li>
<li>指定<strong><code>Spring MVC</code>的视图解析器</strong>，配置视图解析器，将ModelAndView及字符串解析为具体的页面。</li>
</ul>
<p><strong><code>linj2n.servlet.xml</code></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context-4.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描web包，应用Spring的注解 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.linj2n.web"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器，将ModelAndView及字符串解析为具体的页面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:viewClass</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">p:prefix</span>=<span class="string">"/WEB-INF/jsp/"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">p:suffix</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="JSP视图页面"><a href="#JSP视图页面" class="headerlink" title="JSP视图页面"></a>JSP视图页面</h2><p>登录模块包括两个 JSP 页面，分别是登录页面 login.jsp 和欢迎页面 main.jsp。</p>
<h3 id="1-登录页面-login-jsp"><a href="#1-登录页面-login-jsp" class="headerlink" title="1.登录页面 login.jsp"></a>1.登录页面 login.jsp</h3><p><strong><code>login.jsp</code></strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;!empty error&#125;"</span>&gt;</span><br><span class="line">	        &lt;font color="red"&gt;&lt;c:out value="$&#123;error&#125;" /&gt;&lt;/font&gt;</span><br><span class="line">		&lt;/c:if&gt;        </span><br><span class="line">		&lt;form action=<span class="string">"&lt;c:url value="</span>loginCheck.html<span class="string">"/&gt;"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">			用户名：</span><br><span class="line">			&lt;input type=<span class="string">"text"</span> name=<span class="string">"userName"</span>&gt;</span><br><span class="line">			&lt;br&gt;</span><br><span class="line">			密 码：</span><br><span class="line">			&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;</span><br><span class="line">			&lt;br&gt;</span><br><span class="line">			&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span> /&gt;</span><br><span class="line">			&lt;input type=<span class="string">"reset"</span> value=<span class="string">"重置"</span> /&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong><code>注：</code></strong></p>
<ul>
<li><code>login.jsp</code>页面有两个用处，作为登录页面和登录失败后的响应页面，JSTL 标签中引用 <code>error</code> 变量，这个变量就是前面 <code>LoginController</code> 中返回的<code>ModelAndView(&quot;login&quot;,&quot;error&quot;,&quot;用户名或密码错误。&quot;)</code>对象所声明的<code>error</code>参数。</li>
</ul>
<h3 id="2-欢迎页面-main-jsp"><a href="#2-欢迎页面-main-jsp" class="headerlink" title="2.欢迎页面 main.jsp"></a>2.欢迎页面 main.jsp</h3><p><strong><code>main.jsp</code></strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=ISO-8859-1"</span>&gt;</span><br><span class="line">&lt;title&gt;欢迎！&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    $&#123;user.userName&#125;,欢迎您.</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="运行-Web-应用"><a href="#运行-Web-应用" class="headerlink" title="运行 Web 应用"></a>运行 Web 应用</h1><p>打开<code>Maven Project</code>窗口，双击<code>jetty:run</code>，运行模式启动 Jetty 服务器。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-5.png" alt="spring-hw-pic-5"><br>在浏览器中输入<code>localhost:8000/spring-helloworld/index.html</code>。输入账号<code>admin</code>和密码<code>123456</code>。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-6.png" alt="spring-hw-pic-6"><br>确认后转入登录界面。<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-7.png" alt="spring-hw-pic-7"><br>错误界面<br><img src="http://p5twacobv.bkt.clouddn.com/spring-hw-pic-8.png" alt="spring-hw-pic-8"><br>至此，一个由 Spring + Spring MVC + Mysql 开发的登录模块实例完成。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><h2 id="项目开发主要步骤"><a href="#项目开发主要步骤" class="headerlink" title="项目开发主要步骤"></a>项目开发主要步骤</h2><ol>
<li>创建数据库表</li>
<li>创建Maven：主要工作<strong>配置<code>pom.xml</code></strong>，主要导入 Spring 及其他依赖。</li>
<li>划定包结构：通常为 domain-&gt; dao-&gt; service-&gt; web</li>
<li>[<strong>持久层</strong>]开发 domian 相关实体类，<strong>无需配置文件。</strong></li>
<li>[<strong>持久层</strong>]开发 dao 层接口、实现类，<strong>配置<code>resources/context.xml</code>使注解生效。</strong> </li>
<li>[<strong>业务层</strong>]开发 service 相关接口、实现类，一般需要整合 domain 与 dao 层类，<strong>配置<code>src/main/resources/context.xml</code>使注解生效。</strong></li>
<li>[<strong>展示层</strong>]使用Spring MVC 框架开发 Web 层</li>
<li>测试</li>
</ol>
<p><strong>其中 Spring MVC 框架开发步骤如下：具体见<a href="">Spring MVC</a></strong></p>
<ol>
<li>配置<strong><code>web.xml</code></strong>，加载<code>context.xml</code>、<code>listener</code>、<code>servlet</code>、<code>servlet-mapping</code>。</li>
<li>编写 <code>Controller</code>类</li>
<li>配置<strong><code>[servlet-name]-servlet.xml</code></strong>，目的：（1）使得上一步编写的 <code>Controller</code>类注解生效。（2）指定视图解析器，配置视图解析器。</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java-Web/" rel="tag"># Java Web</a>
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/08/spring-note-1/" rel="next" title="Spring学习总结（1） Spring 概述与入门配置">
                <i class="fa fa-chevron-left"></i> Spring学习总结（1） Spring 概述与入门配置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/18/spring-note-3/" rel="prev" title="Spring学习总结（3）Spring Boot + Spring MVC 入门实例">
                Spring学习总结（3）Spring Boot + Spring MVC 入门实例 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="linj2n" />
          <p class="site-author-name" itemprop="name">linj2n</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/linj2n" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/p/1005055919829882" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#准备"><span class="nav-number">1.</span> <span class="nav-text">准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#开发环境"><span class="nav-number">1.1.</span> <span class="nav-text">开发环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建库表"><span class="nav-number">1.2.</span> <span class="nav-text">创建库表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#建立Maven项目"><span class="nav-number">2.</span> <span class="nav-text">建立Maven项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-pom-xml-文件依赖"><span class="nav-number">2.1.</span> <span class="nav-text">配置 pom.xml 文件依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类包规划"><span class="nav-number">2.2.</span> <span class="nav-text">类包规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring配置文件"><span class="nav-number">2.3.</span> <span class="nav-text">Spring配置文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#持久层"><span class="nav-number">3.</span> <span class="nav-text">持久层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#domain-包"><span class="nav-number">3.1.</span> <span class="nav-text">domain 包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用户领域对象"><span class="nav-number">3.1.1.</span> <span class="nav-text">用户领域对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#登录日志领域对象"><span class="nav-number">3.1.2.</span> <span class="nav-text">登录日志领域对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dao-包"><span class="nav-number">3.2.</span> <span class="nav-text">dao 包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UserDao"><span class="nav-number">3.2.1.</span> <span class="nav-text">UserDao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoginLogDao"><span class="nav-number">3.2.2.</span> <span class="nav-text">LoginLogDao</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在xml文件中配置Bean类"><span class="nav-number">3.3.</span> <span class="nav-text">在xml文件中配置Bean类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#业务层"><span class="nav-number">4.</span> <span class="nav-text">业务层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UserServiceApi"><span class="nav-number">4.1.</span> <span class="nav-text">UserServiceApi</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UserServiceImpl"><span class="nav-number">4.2.</span> <span class="nav-text">UserServiceImpl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在xml中配置Bean类"><span class="nav-number">4.3.</span> <span class="nav-text">在xml中配置Bean类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单元测试"><span class="nav-number">4.4.</span> <span class="nav-text">单元测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#展示层"><span class="nav-number">5.</span> <span class="nav-text">展示层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Spring-MVC-框架"><span class="nav-number">5.1.</span> <span class="nav-text">配置Spring MVC 框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理登录请求"><span class="nav-number">5.2.</span> <span class="nav-text">处理登录请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-编写LoginController控制器类"><span class="nav-number">5.2.1.</span> <span class="nav-text">1.编写LoginController控制器类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Spring-MVC-配置文件"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.Spring MVC 配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSP视图页面"><span class="nav-number">5.3.</span> <span class="nav-text">JSP视图页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-登录页面-login-jsp"><span class="nav-number">5.3.1.</span> <span class="nav-text">1.登录页面 login.jsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-欢迎页面-main-jsp"><span class="nav-number">5.3.2.</span> <span class="nav-text">2.欢迎页面 main.jsp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运行-Web-应用"><span class="nav-number">6.</span> <span class="nav-text">运行 Web 应用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">7.</span> <span class="nav-text">小结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#项目开发主要步骤"><span class="nav-number">7.1.</span> <span class="nav-text">项目开发主要步骤</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linj2n</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.2"></script>



  

  

  

  

  

  

</body>
</html>
